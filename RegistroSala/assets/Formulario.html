<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Formulario de Reserva</title>
  <link rel="stylesheet" href="Css/Formulario.css">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="py-4">
  <div class="container reserva-container my-3 p-4">
    <div class="text-center mb-4">
      <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTuc9Aq8alOIs33kPxaNZTFH9VJ8gF3vIH7oA&s" 
           alt="Logo Universidad del Mar" 
           class="img-fluid logo">
      <h1 class="mt-3">Reservar Salas de Cómputo</h1>
      <h2 class="h4">UNIVERSIDAD DEL MAR</h2>
      <h3 class="h5">Solicitud de reserva</h3>
    </div>

    <form id="formularioReserva">
      <div class="mb-3">
        <label for="matricula" class="form-label">Matrícula:</label>
        <input type="text" class="form-control" id="matricula" required>
      </div>

      <div class="mb-3">
        <label class="form-label">Datos del alumno:</label>
        <div id="datos-alumno" class="alert alert-info p-2">
          Ingrese su matrícula para autocompletar
        </div>
      </div>

      <div class="mb-3">
        <label for="sala" class="form-label">Seleccionar sala:</label>
        <select class="form-select" id="sala" required>
          <option value="">Seleccione una sala</option>
          <option value="A">Sala A</option>
          <option value="B">Sala B</option>
          <option value="C">Sala C</option>
          <option value="D">Sala D</option>
        </select>
      </div>

      <div class="row mb-3">
        <div class="col-md-6">
          <label for="hora-entrada" class="form-label">Hora de entrada:</label>
          <input type="time" class="form-control" id="hora-entrada" required>
        </div>
        <div class="col-md-6">
          <label for="hora-salida" class="form-label">Hora de salida:</label>
          <input type="time" class="form-control" id="hora-salida" required>
        </div>
      </div>

      <p class="text-muted text-center small mb-3">
        Si se selecciona un día que no corresponde a un sábado o a un domingo, únicamente se permitirán reservas para horarios posteriores a las 18:00 horas.
      </p>

      <div class="mb-4">
        <label class="form-label d-block">Equipos solicitados:</label>
        <div class="d-flex justify-content-around flex-wrap">
          <div class="form-check equipo-checkbox">
            <input class="form-check-input" type="checkbox" id="equipo-pc" value="PC de la sala">
            <label class="form-check-label" for="equipo-pc">PC de la sala</label>
          </div>
          <div class="form-check equipo-checkbox">
            <input class="form-check-input" type="checkbox" id="equipo-laptop" value="Laptop">
            <label class="form-check-label" for="equipo-laptop">Laptop</label>
          </div>
          <div class="form-check equipo-checkbox">
            <input class="form-check-input" type="checkbox" id="equipo-proyector" value="Proyector">
            <label class="form-check-label" for="equipo-proyector">Proyector</label>
          </div>
        </div>
      </div>

      <div class="d-grid">
        <button type="submit" class="btn btn-primary">Registrar</button>
      </div>
    </form>
  </div>

  <div class="footer-bar d-flex justify-content-center align-items-center">
    <button id="volverBtn" class="btn btn-light btn-sm me-2">Volver</button>
  </div>

  <!-- jQuery y Bootstrap JS -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

  <!-- Script externo solo con la base de alumnos -->
  <script src="Js/Alumnos.js"></script>

  <script>
    $(document).ready(function() {
      function buscarAlumnoPorMatricula(matricula) {
        return alumnos.find(alumno => alumno.matricula === matricula);
      }

      $("#matricula").on('input', function() {
        const matricula = $(this).val().trim();
        const alumno = buscarAlumnoPorMatricula(matricula);

        if (alumno) {
          $("#datos-alumno").html(`
            <p><strong>Nombre:</strong> ${alumno.nombre}</p>
            <p><strong>Carrera:</strong> ${alumno.carrera}</p>
            <p><strong>Semestre:</strong> ${alumno.semestre}</p>
          `);
        } else {
          $("#datos-alumno").html(matricula ? 
            "Matrícula no encontrada" : 
            "Ingrese su matrícula para autocompletar");
        }
      });

      $("#formularioReserva").submit(function(e) {
        e.preventDefault();

        const matricula = $("#matricula").val().trim();
        const alumno = buscarAlumnoPorMatricula(matricula);

        if (!alumno) {
          alert("Por favor ingrese una matrícula válida");
          return;
        }

        const confirmacion = confirm("¿Está seguro de hacer el registro?");
        if (confirmacion) {
          const equipos = [];
          $('input[type="checkbox"]:checked').each(function() {
            equipos.push($(this).val());
          });

          const reserva = {
            matricula: matricula,
            nombre: alumno.nombre,
            carrera: alumno.carrera,
            semestre: alumno.semestre,
            sala: $("#sala").val(),
            entrada: $("#hora-entrada").val(),
            salida: $("#hora-salida").val(),
            equipos: equipos
          };

          localStorage.setItem('reservaActual', JSON.stringify(reserva));
          window.location.href = "reporteFin.html";
        } else {
          $("#formularioReserva")[0].reset();
          $("#datos-alumno").html("Ingrese su matrícula para autocompletar");
        }
      });

      $("#volverBtn").click(function() {
        window.location.href = "Bienvenido.html";
      });
    });
  </script>
</body>
</html>
