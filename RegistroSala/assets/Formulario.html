<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Formulario de Reserva</title>
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body {
      background-color: #f8f9fa;
    }
    .reserva-container {
      max-width: 700px;
      background-color: white;
      border: 1px solid #ddd;
      border-radius: 10px;
    }
    .footer-bar {
      background-color: #6a2016;
      height: 60px;
    }
    .logo {
      width: 100px;
    }
    .equipo-checkbox {
      margin-right: 15px;
    }
  </style>
</head>
<body class="py-4">
  <div class="container reserva-container my-3 p-4">
    <div class="text-center mb-4">
      <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTuc9Aq8alOIs33kPxaNZTFH9VJ8gF3vIH7oA&s" 
           alt="Logo Universidad del Mar" 
           class="img-fluid logo">
      <h1 class="mt-3">Reservar Salas de Cómputo</h1>
      <h2 class="h4">UNIVERSIDAD DEL MAR</h2>
      <h3 class="h5">Solicitud de reserva</h3>
    </div>

    <form id="formularioReserva">
      <!-- Campo de matrícula -->
      <div class="mb-3">
        <label for="matricula" class="form-label">Matrícula:</label>
        <input type="text" class="form-control" id="matricula" required>
      </div>

      <!-- Datos del alumno (autocompletados) -->
      <div class="mb-3">
        <label class="form-label">Datos del alumno:</label>
        <div id="datos-alumno" class="alert alert-info p-2">
          Ingrese su matrícula para autocompletar
        </div>
      </div>

      <!-- Selección de sala -->
      <div class="mb-3">
        <label for="sala" class="form-label">Seleccionar sala:</label>
        <select class="form-select" id="sala" required>
          <option value="">Seleccione una sala</option>
          <option value="A">Sala A</option>
          <option value="B">Sala B</option>
          <option value="C">Sala C</option>
          <option value="D">Sala D</option>
        </select>
      </div>

      <!-- Fecha de reserva -->
      <div class="mb-3">
        <label for="fecha-reserva" class="form-label">Fecha de reserva:</label>
        <input type="date" class="form-control" id="fecha-reserva" required>
      </div>

      <!-- Horario -->
      <div class="row mb-3">
        <div class="col-md-6">
          <label for="hora-entrada" class="form-label">Hora de entrada:</label>
          <input type="time" class="form-control" id="hora-entrada" required>
        </div>
        <div class="col-md-6">
          <label for="hora-salida" class="form-label">Hora de salida:</label>
          <input type="time" class="form-control" id="hora-salida" required>
        </div>
      </div>

      <p class="text-muted text-center small mb-3">
        Si se selecciona un día que no corresponde a un sábado o a un domingo, únicamente se permitirán reservas para horarios posteriores a las 18:00 horas.
      </p>

      <!-- Equipos solicitados -->
      <div class="mb-4">
        <label class="form-label d-block">Equipos solicitados:</label>
        <div class="d-flex justify-content-around flex-wrap">
          <div class="form-check equipo-checkbox">
            <input class="form-check-input" type="checkbox" id="equipo-pc" value="PC de la sala">
            <label class="form-check-label" for="equipo-pc">PC de la sala</label>
          </div>
          <div class="form-check equipo-checkbox">
            <input class="form-check-input" type="checkbox" id="equipo-laptop" value="Laptop">
            <label class="form-check-label" for="equipo-laptop">Laptop</label>
          </div>
          <div class="form-check equipo-checkbox">
            <input class="form-check-input" type="checkbox" id="equipo-proyector" value="Proyector">
            <label class="form-check-label" for="equipo-proyector">Proyector</label>
          </div>
        </div>
      </div>

      <div class="d-grid">
        <button type="submit" class="btn btn-primary">Registrar</button>
      </div>
    </form>
  </div>

  <div class="footer-bar d-flex justify-content-center align-items-center">
    <button id="volverBtn" class="btn btn-light btn-sm me-2">Volver</button>
  </div>

  <!-- jQuery y Bootstrap JS -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  
  <!-- Script con la base de alumnos -->
  <script>
    // Base de datos de alumnos (simulada)
    const alumnos = [
      { matricula: "A12345", nombre: "Juan Pérez López", carrera: "Ingeniería en Sistemas", semestre: "6" },
      { matricula: "A67890", nombre: "María García Ruiz", carrera: "Licenciatura en Informática", semestre: "4" },
      { matricula: "B12345", nombre: "Carlos Martínez Sánchez", carrera: "Ingeniería en Software", semestre: "8" },
      { matricula: "B67890", nombre: "Ana Rodríguez Fernández", carrera: "Ciencias de la Computación", semestre: "5" }
    ];
  </script>
  
  <script>
    $(document).ready(function() {
      // Inicializar matriz de reservas si no existe
      if (!localStorage.getItem('reservas')) {
        localStorage.setItem('reservas', JSON.stringify([]));
      }

      // Función para buscar alumno por matrícula
      function buscarAlumnoPorMatricula(matricula) {
        return alumnos.find(alumno => alumno.matricula === matricula);
      }

      // Autocompletar datos al ingresar matrícula
      $("#matricula").on('input', function() {
        const matricula = $(this).val().trim();
        const alumno = buscarAlumnoPorMatricula(matricula);
        
        if (alumno) {
          $("#datos-alumno").html(`
            <p><strong>Nombre:</strong> ${alumno.nombre}</p>
            <p><strong>Carrera:</strong> ${alumno.carrera}</p>
            <p><strong>Semestre:</strong> ${alumno.semestre}</p>
          `);
        } else {
          $("#datos-alumno").html(matricula ? 
            "Matrícula no encontrada" : 
            "Ingrese su matrícula para autocompletar");
        }
      });

      // Validar horario según día de la semana
      $("#fecha-reserva").change(function() {
        const fecha = new Date($(this).val());
        const diaSemana = fecha.getDay(); // 0=Domingo, 1=Lunes, ..., 6=Sábado
        
        if (diaSemana > 0 && diaSemana < 6) { // Día laboral (lunes a viernes)
          $("#hora-entrada").attr("min", "18:00");
          $("#hora-salida").attr("min", "18:00");
        } else {
          $("#hora-entrada").removeAttr("min");
          $("#hora-salida").removeAttr("min");
        }
      });

      // Procesar el formulario
      $("#formularioReserva").submit(function(e) {
        e.preventDefault();
        
        const matricula = $("#matricula").val().trim();
        const alumno = buscarAlumnoPorMatricula(matricula);
        
        if (!alumno) {
          alert("Por favor ingrese una matrícula válida");
          return;
        }

        // Validar horario de salida mayor que entrada
        const horaEntrada = $("#hora-entrada").val();
        const horaSalida = $("#hora-salida").val();
        
        if (horaSalida <= horaEntrada) {
          alert("La hora de salida debe ser posterior a la hora de entrada");
          return;
        }

        // Obtener equipos seleccionados
        const equipos = [];
        $('input[type="checkbox"]:checked').each(function() {
          equipos.push($(this).val());
        });

        if (equipos.length === 0) {
          alert("Por favor seleccione al menos un equipo");
          return;
        }

        // Crear objeto con los datos de la reserva
        const reserva = {
          matricula: matricula,
          nombre: alumno.nombre,
          carrera: alumno.carrera,
          semestre: alumno.semestre,
          sala: $("#sala").val(),
          fecha: $("#fecha-reserva").val(),
          entrada: horaEntrada,
          salida: horaSalida,
          equipos: equipos,
          estado: "pendiente", // Puede ser "pendiente", "confirmada", "cancelada"
          fechaRegistro: new Date().toISOString()
        };

        // Guardar reserva en localStorage
        localStorage.setItem('reservaActual', JSON.stringify(reserva));
        
        // Obtener todas las reservas existentes
        let reservas = JSON.parse(localStorage.getItem('reservas'));
        
        // Agregar la nueva reserva
        reservas.push(reserva);
        
        // Guardar la matriz actualizada
        localStorage.setItem('reservas', JSON.stringify(reservas));
        
        // Redirigir a la página de reporte
        window.location.href = "reporteAlumno.html";
      });

      // Botón para volver
      $("#volverBtn").click(function() {
        window.location.href = "Bienvenido.html";
      });

      // Establecer fecha mínima como hoy
      const hoy = new Date().toISOString().split('T')[0];
      $("#fecha-reserva").attr('min', hoy);
    });
  </script>
</body>
</html>