<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Inicio de sesión</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="Css/inicio.css">
</head>
<body>
  <div class="contenedor">
    <img class="logo" src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTuc9Aq8alOIs33kPxaNZTFH9VJ8gF3vIH7oA&s" alt="Logo Universidad del Mar">
    <h2>Reservar Salas de Cómputo</h2>
    <p>UNIVERSIDAD DEL MAR</p>
    <h3>Inicio de sesión</h3>
    <input type="text" id="matricula" placeholder="Ingrese su matrícula">
    <br>
    <button onclick="validarMatricula()">INICIAR SESIÓN</button>
    <div id="horaActual"></div>
  </div>

  <!-- Modal -->
  <div id="myModal" class="modal">
    <div class="modal-content">
      <span class="close" onclick="cerrarModal()">&times;</span>
      <p id="mensajeBienvenida"></p>
      <button onclick="cerrarModal()">Aceptar</button>
    </div>
  </div>

  <script src="Js/Alumnos.js"></script>
  <script>
    // Función para validar la matrícula
    function validarMatricula() {
      const input = document.getElementById("matricula").value.trim();
      const alumno = alumnos.find(a => a.matricula === input);

      if (alumno) {
        const ahora = new Date();
        const horaEntrada = ahora.toLocaleTimeString('es-ES', {hour: '2-digit', minute: '2-digit'});
        
        // Obtener reservas del alumno
        let reservas = JSON.parse(localStorage.getItem('reservasConfirmadas')) || [];
        
        // Buscar reservas activas del alumno
        const reservasAlumno = reservas.filter(r => 
          r.matricula === input && 
          (r.estado === "Reservado" || r.estado === "En uso") &&
          (!r.horaRealEntrada || !r.horaRealSalida)
        );
        
        if (reservasAlumno.length > 0) {
          // Actualizar la primera reserva encontrada
          const reserva = reservasAlumno[0];
          
          if (!reserva.horaRealEntrada) {
            // Registrar entrada
            reserva.horaRealEntrada = horaEntrada;
            reserva.estado = "En uso";
            document.getElementById("mensajeBienvenida").innerHTML = 
              `Bienvenido ${alumno.nombre}<br>
               Hora de entrada registrada: ${horaEntrada}<br>
               Sala asignada: ${reserva.sala}`;
          } else {
            // Registrar salida
            reserva.horaRealSalida = horaEntrada;
            reserva.estado = "Finalizado";
            document.getElementById("mensajeBienvenida").innerHTML = 
              `Sesión finalizada ${alumno.nombre}<br>
               Hora de salida registrada: ${horaEntrada}<br>
               Gracias por usar nuestras instalaciones`;
          }
          
          // Actualizar localStorage
          localStorage.setItem('reservasConfirmadas', JSON.stringify(reservas));
        } else {
          document.getElementById("mensajeBienvenida").innerHTML = 
            `Bienvenido ${alumno.nombre}<br>
             No tienes reservas activas en este momento.`;
        }
        
        document.getElementById("myModal").style.display = "block";
        localStorage.setItem("alumno", JSON.stringify(alumno));
      } else {
        alert("Matrícula inválida.");
      }
    }
</script>
</body>